# webpack はフロントエンド標準ビルドツールの夢を見るか？

2017年にES Modules をネイティブサポートするようになってパッケージのダウンロード数が一気に増えた！

## すごいぞ！webpack

- ES Modules, CommonJS, AMD を含めたさまざまモジュールをサポート
    - 異なるモジュール構文が混在してもおかまいなしに依存関係を解決してバンドルしてくれる
- npm パッケージの大半は今でも CommonJS 形式で提供されているが import 構文をフルに使って読み込むことができるのは webpack のおかげ
- ローダ（Loader）というモジュールを組み入れることによって JSON や CSS や 画像ファイルも扱えるようになる
- Create React Appで生成したプロジェクトでは Babel Loader 経由で ES2015+ の最新の JavaScript や JSX, TypeScript もコンパイルされてバンドルされるようなっている

## React では……

- webpack によって ES Modules の構文がエミュレートされ、さらに Create React App によってそれが隠蔽されることで意識することなく **import** や **export** が使えるようになっている

## そもそもモジュールバンドラのお仕事とは？

### Minify

- 空白文字やコメント、実行されないコードやコンソール出力などを削除、変数名や 関数名を短縮、条件文や宣言文を簡略化するなどして、スクリプトファイルの容量を最小限に圧 縮する

### Tree Shaking

- こからも参照されていないモジュールを検出してバンドル対象から外し、出力ファイルの容量を削減する

### 画像データのインライン埋め込み

- 画像ファイルを『データ URL126』としてドキュメントに インラインで埋め込む(※ CRA のデフォルト設定では 10KB 以下の画像ファイルはデータ URL 化される)
- リクエストヘッダーがなくなるのでデータ量は変わらないが GoogleChromeの開発者ツールのネットワークに出てこない
- 画像を Base64 でエンコードを自動でやってくれているってことですかね……
- 詳しくはここのページを読むとすごくわかる -> [表示速度改善　Data URIスキーム - 仕組みとメリット | CodeGrid](https://app.codegrid.net/entry/datauri-basic)

### コード分割

- モジュールの共有度合による自動分割に加え、開発者がアプリケーションの UI や規模を考慮しつつ、バンドルファイルを適切な粒度に分割し、それぞれが適切なタイミン グで読み込まれるようにできる

### キャッシュ管理

- ビルド時に出力ファイルの名前に差分単位でユニークな ID を付与することで、ブラウザキャッシュが適切に使われるようにし、かつキャッシュが残ることによる挙動の不具合を予防する

### その他

- Babel で ES2015+ のコードを ES5 にコンパイルする（パフォーマンスがよくなるため）
    - コンパイルの対象が個々のファイルではなくプロジェクト全体で最適化され、かつ出力されるコードが JavaScript エンジンにとって解釈しやすいものになってるから
    - TypeScript のコンパイラも同様
